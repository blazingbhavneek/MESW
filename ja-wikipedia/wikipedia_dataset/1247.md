# 状態空間 (制御理論)

状態空間（じょうたいくうかん、英: State Space）あるいは状態空間表現（じょうたいくうかんひょうげん、英: State Space Representation）は、制御工学において、物理的システムを入力と出力と状態変数を使った一階連立微分方程式で表した数学的モデルである。入力、出力、状態は複数存在することが多いため、これらの変数はベクトルとして表され、行列形式で微分代数方程式を表す（力学系が線形で時不変の場合）。状態空間表現は時間領域の手法であり、これを使うと複数の入力と出力を持つシステムをコンパクトにモデル化でき、解析が容易になる。周波数領域では、
  
    
      
        p
      
    
    {\displaystyle p}
  
 個の入力と 
  
    
      
        q
      
    
    {\displaystyle q}
  
 個の出力があるとき、システム全体を現すには 
  
    
      
        q
        ×
        p
      
    
    {\displaystyle q\times p}
  
 個のラプラス変換を書かなければならない。周波数領域の手法とは異なり、状態空間表現では、線形性と初期値がゼロという制限は存在しない。「状態空間」は、その次元軸が個々の状態変数に対応することから名づけられている。システムの状態はこの空間内のベクトルとして表現される。

状態変数
状態変数は、任意の時点でシステム全体の状態を表せるシステム変数群の最小の部分集合である。状態変数群は線形独立でなければならない。すなわち、ある状態変数を別の状態変数群の線形結合で表すことはできない。システムを表現するのに必要な状態変数の最小個数 
  
    
      
        n
      
    
    {\displaystyle n}
  
 は、一般にそのシステムを定義する微分方程式の次数に等しい。システムが伝達関数形式で表されるとき、状態変数の最小個数は伝達関数を適切に約分したときの分母の次数に等しい。状態空間実現（state space realization）を伝達関数形式に変換することで、システムについての内部情報を失う可能性があるが、状態空間実現では不安定なはずなのに安定しているシステムを説明できることがある。電気回路では、状態変数の数は回路内のエネルギー蓄積部品（コンデンサやコイル）の個数と同じであることが多い（常にそうとは限らない）。

線形システム
p
      
    
    {\displaystyle p}
  
 個の入力変数、
  
    
      
        q
      
    
    {\displaystyle q}
  
 個の出力変数、
  
    
      
        n
      
    
    {\displaystyle n}
  
 個の状態変数の状態空間表現の一般形は次のようになる。

ここで、

  
    
      
        x
        (
        ⋅
        )
      
    
    {\displaystyle x(\cdot )}
  
 を「状態ベクトル」、
  
    
      
        y
        (
        ⋅
        )
      
    
    {\displaystyle y(\cdot )}
  
 を「出力ベクトル」、
  
    
      
        u
        (
        ⋅
        )
      
    
    {\displaystyle u(\cdot )}
  
 を「入力（または制御）ベクトル」、
  
    
      
        A
        (
        ⋅
        )
      
    
    {\displaystyle A(\cdot )}
  
 を「状態行列」、
  
    
      
        B
        (
        ⋅
        )
      
    
    {\displaystyle B(\cdot )}
  
 を「入力行列」、
  
    
      
        C
        (
        ⋅
        )
      
    
    {\displaystyle C(\cdot )}
  
 を「出力行列」、
  
    
      
        D
        (
        ⋅
        )
      
    
    {\displaystyle D(\cdot )}
  
 を「直達行列」と呼ぶ。単純化するため、
  
    
      
        D
        (
        ⋅
        )
      
    
    {\displaystyle D(\cdot )}
  
 は零行列とされることが多い。すなわち、システムには直達項（feedthrough term）が無いものとして扱う。なお、この一般形式では全ての行列は時変とみなされ、その要素は時と共に変化するものとされている。時変数 
  
    
      
        t
      
    
    {\displaystyle t}
  
 は連続的（
  
    
      
        t
        ∈
        
          R
        
      
    
    {\displaystyle t\in \mathbb {R} }
  
）でも離散的（
  
    
      
        t
        ∈
        
          Z
        
      
    
    {\displaystyle t\in \mathbb {Z} }
  
）でもよい。後者の場合は時変数を 
  
    
      
        k
      
    
    {\displaystyle k}
  
 で表すことが多い。時変か時不変か、連続か離散かによって、状態空間モデルの表現は以下のように変化する。

システムのさまざまな特性（可制御性、可観測性、安定性）は、行列 A、B、CとDに決められる。

伝達関数
連続時不変状態空間モデルの伝達関数は、次のように導出できる。
まず、次の式

のラプラス変換を求める。

次に 
  
    
      
        
          X
        
        (
        s
        )
      
    
    {\displaystyle \mathbf {X} (s)}
  
 に着目すると次のように変形できる。

これを使って、出力方程式の 
  
    
      
        
          X
        
        (
        s
        )
      
    
    {\displaystyle \mathbf {X} (s)}
  
 を置き換える。

となる。伝達関数 
  
    
      
        
          G
        
        (
        s
        )
      
    
    {\displaystyle \mathbf {G} (s)}
  
 はシステムの出力と入力の比であるから、次のようになる。

従って、上で求めた 
  
    
      
        
          Y
        
        (
        s
        )
      
    
    {\displaystyle \mathbf {Y} (s)}
  
 で置き換えれば 
  
    
      
        
          U
        
        (
        s
        )
      
    
    {\displaystyle \mathbf {U} (s)}
  
 が約分され、次の式が得られる。

式の中には、
  
    
      
        
          d
          e
          t
        
        (
        s
        
          I
        
        −
        A
        )
      
    
    {\displaystyle \mathrm {det} (s\mathbf {I} -A)}
  
が
  
    
      
        s
        I
        −
        A
      
    
    {\displaystyle sI-A}
  
 の行列式であり、
  
    
      
        
          a
          d
          j
        
        (
        s
        
          I
        
        −
        A
        )
      
    
    {\displaystyle \mathrm {adj} (s\mathbf {I} -A)}
  
が
  
    
      
        s
        I
        −
        A
      
    
    {\displaystyle sI-A}
  
の余因子行列である。

  
    
      
        
          G
        
        (
        s
        )
      
    
    {\displaystyle \mathbf {G} (s)}
  
 は明らかに 
  
    
      
        q
      
    
    {\displaystyle q}
  
 
  
    
      
        ×
      
    
    {\displaystyle \times }
  

  
    
      
        p
      
    
    {\displaystyle p}
  
 の次元を持ち、全体で 
  
    
      
        q
        p
      
    
    {\displaystyle qp}
  
 個の要素から成る。従って、個々の入力に対して 
  
    
      
        q
      
    
    {\displaystyle q}
  
 個の伝達関数があり、それぞれが個々の出力に対応している。そのため、複数入力/複数出力システムでは状態空間表現の方が好まれる。
なお、
  
    
      
        
          d
          e
          t
        
        (
        s
        
          I
        
        −
        A
        )
      
    
    {\displaystyle \mathrm {det} (s\mathbf {I} -A)}
  
は特性多項式と呼ばれる。その多項式の根（固有値）から、システムの伝達関数の極が得られる。それらの極を使って、そのシステムの安定性を解析できる。
  
    
      
        
          
            G
          
        
        (
        s
        )
      
    
    {\displaystyle {\textbf {G}}(s)}
  
 の分子にあるゼロも同様に、システムが最小位相かどうかの判定に使うことができる。

  
    
      
        (
        s
        
          I
        
        −
        A
        
          )
          
            −
            1
          
        
      
    
    {\displaystyle (s\mathbf {I} -A)^{-1}}
  
を計算するため、下記のアルゴリズムがある。

Souriau-Frame-Faddeev アルゴリズム
その中には、

または

最後の等式は、前の演算の精度を検査することができる。

プロパーな伝達関数
プロパーな伝達関数（「厳密にプロパー」ではない）の実現も容易に得られる。その場合伝達関数を、厳密にプロパーな部分と定数部分という2つの部分に分割するというトリックを用いる。

厳密にプロパーな伝達関数は上述した方法で正準状態空間実現に変換できる。定数の状態空間実現が 
  
    
      
        
          
            y
          
        
        (
        t
        )
        =
        
          
            G
          
        
        (
        ∞
        )
        
          
            u
          
        
        (
        t
        )
      
    
    {\displaystyle {\textbf {y}}(t)={\textbf {G}}(\infty ){\textbf {u}}(t)}
  
 であることは明らかである。以上から、行列 A, B, C の状態空間実現は厳密にプロパーな部分から得られ、行列 D は定数部分から得られる。
もう少し判りやすくするため、例を挙げて説明する。

この伝達関数から、次の可制御実現が得られる。

出力が入力に直接依存している点に注意されたい。これは伝達関数の 
  
    
      
        
          
            G
          
        
        (
        ∞
        )
      
    
    {\displaystyle {\textbf {G}}(\infty )}
  
 定数部分によるものである。

可制御性
従って、状態の可制御性（controllability）条件は、許容範囲内の入力で、ある有限の時間をかければ状態をある初期値から特定の値へと変化させることが可能であることを暗に示している。連続時不変状態空間モデルが制御可能（controllable）であるとは、次が成り立つ場合である。

可観測性
可観測性（observability）とは、システムの外部出力を観測することでシステムの内部状態を推測可能かどうかの尺度である。システムの可観測性と可制御性は数学的な双対である。
連続時不変状態空間モデルが観測可能（observable）であるとは、次が成り立つ場合である。

なお、Rankとは行列内の線形独立な列の数である。

正準実現
厳密にプロパー（strictly proper）な伝達関数は、次のようにして容易に状態空間に変換可能である。
伝達関数を展開して分子と分母の全ての係数を明らかにする。これは、次のような形式になる。

これらの係数を以下のように直接に状態空間モデルに挿入できる。

この状態空間実現を可制御正準形式（controllable canonical form）と呼ぶ。「可制御」とされるのは、得られるモデルが可制御であることが保証されているためである。
伝達関数の係数を使って、次のような正準形式も構築可能である。

この状態空間実現を可観測正準形式（observable canonical form）と呼ぶ。「可観測」とされるのは、得られるモデルが可観測であることが保証されているためである。

安定性
安定性については、外部的な安定に関するBIBO安定性があり、内部的な安定に関するリアプノフ安定性と漸近安定性など平衡状態の安定性もある。非線形システムの平衡状態は唯一ではないが、線形システムの状態行列A(t)が可逆的であるとき平衡状態が
  
    
      
        
          0
        
      
    
    {\displaystyle \mathbf {0} }
  
しかない。
BIBO安定性はシステムの零状態応答を着目し、平衡状態の安定性はシステムの零入力応答を着目する。なお、リアプノフ安定性は、力学系の安定性理論の基礎である。安定性の判定には、状態行列Aとの密接な関係がある。

BIBO安定性
BIBO安定性は、入力は有界するとき出力は必ず有界であること。これは、不安定な極がゼロによって打ち消される場合と考えられる。
システムをプロパーな伝達関数
  
    
      
        
          G
        
        (
        s
        )
        =
        
          d
          e
          t
        
        (
        s
        
          I
        
        −
        A
        )
      
    
    {\displaystyle \mathrm {G} (s)=\mathrm {det} (s\mathbf {I} -A)}
  
としてモデル化するとき、BIBO安定の必要十分条件は、システムの極が全部複素平面の左平面になければならないこと、または極が全部負の実部を持つこと。

リアプノフ安定性
漸近安定性
状態空間の原点はリアプノフ安定の平衡状態である上に、次を満たす
  
    
      
        δ
        (
        
          t
          
            0
          
        
        )
        >
        0
      
    
    {\displaystyle \delta (t_{0})>0}
  
が存在すれば、状態空間の原点は時刻
  
    
      
        
          t
          
            0
          
        
      
    
    {\displaystyle t_{0}}
  
の漸近安定状態という。

  
    
      
        δ
        (
        
          t
          
            0
          
        
        )
      
    
    {\displaystyle \delta (t_{0})}
  
は
  
    
      
        
          t
          
            0
          
        
      
    
    {\displaystyle t_{0}}
  
と関係ないとき、状態空間の原点は一様漸近安定状態という。
LTIシステムが漸近安定する必要十分条件は、システムの固有値（Aの固有値）がすべて負の実部を持つ。

安定性の間の関係
漸近安定のシステムは必ずBIBO安定する。
システムが可制御性または可観測性持たないとき、伝達関数の極が状態行列Aのスペクトル（固有値の集）の真部分集合であるため、BIBO安定は必ず漸近安定ではない。でも、
LTIシステムには可制御性と可観測性が同時にあるとき、以下の命題が等価である。
システムがBIBO安定する。
システムが漸近安定する。
伝達関数の極が負の実部を持つ。
システムの固有値（Aの固有値）が負の実部を持つ。

フィードバック
典型的なフィードバックは、出力に行列 K をかけたものをシステムの入力とする。
system: 
  
    
      
        
          u
        
        (
        t
        )
        =
        K
        
          y
        
        (
        t
        )
      
    
    {\displaystyle \mathbf {u} (t)=K\mathbf {y} (t)}
  

K 内の値には制限はないので、負の値することで容易にネガティブ・フィードバック（負帰還）となる。負の符号は単に表記上の問題であって、式にそれが現われなくとも最終的な結果には何の影響もない。

この式の入力をフィードバックに置き換えると次の式になる。

出力方程式を 
  
    
      
        
          y
        
        (
        t
        )
      
    
    {\displaystyle \mathbf {y} (t)}
  
 について解き、その結果を状態方程式に当てはめると次のようになる。

この場合の利点は、
  
    
      
        
          (
          
            A
            +
            B
            K
            
              
                (
                
                  I
                  −
                  D
                  K
                
                )
              
              
                −
                1
              
            
            C
          
          )
        
      
    
    {\displaystyle \left(A+BK\left(I-DK\right)^{-1}C\right)}
  
 の固有値分解を使って K を適切に設定することで A の固有値を制御できる点である。これは、開ループ系が制御可能であるか、または A の不安定な固有値を K を適切に設定することで安定にできるということを前提としている。
比較的一般的な単純化として、D を除去し、C を単位元にすると、次のような式が得られる。

こうすると、固有値分解は 
  
    
      
        A
        +
        B
        K
      
    
    {\displaystyle A+BK}
  
 についてのみ行えばよい。

基準となる入力を持つフィードバック
フィードバックに加えて、入力 
  
    
      
        r
        (
        t
        )
      
    
    {\displaystyle r(t)}
  
 がある場合、
  
    
      
        
          u
        
        (
        t
        )
        =
        −
        K
        
          y
        
        (
        t
        )
        +
        
          r
        
        (
        t
        )
      
    
    {\displaystyle \mathbf {u} (t)=-K\mathbf {y} (t)+\mathbf {r} (t)}
  
 となる。

この式に当てはめると、次のようになる。

出力方程式を 
  
    
      
        
          y
        
        (
        t
        )
      
    
    {\displaystyle \mathbf {y} (t)}
  
 について解き、その結果を状態方程式に当てはめると次のようになる。

比較的一般的な単純化として、D を除去すると、次のような式が得られる。

移動する物体の例
古典的な線形システムとして、一次元の移動する物体を考える。壁にバネで繋がれた物体が水平な平面上を移動する場合、ニュートン力学では次の式で表される。

ここで

  
    
      
        y
        (
        t
        )
      
    
    {\displaystyle y(t)}
  
 は位置、
  
    
      
        
          
            
              y
              ˙
            
          
        
        (
        t
        )
      
    
    {\displaystyle {\dot {y}}(t)}
  
 は速度、
  
    
      
        
          
            
              y
              ¨
            
          
        
        (
        t
        )
      
    
    {\displaystyle {\ddot {y}}(t)}
  
 は加速度である。

  
    
      
        u
        (
        t
        )
      
    
    {\displaystyle u(t)}
  
 は加えられた力である。

  
    
      
        
          k
          
            1
          
        
      
    
    {\displaystyle k_{1}}
  
 は粘性摩擦係数である。

  
    
      
        
          k
          
            2
          
        
      
    
    {\displaystyle k_{2}}
  
 はバネ定数である。

  
    
      
        m
      
    
    {\displaystyle m}
  
 は物体の質量である。
この場合の状態方程式は次のようになる。

ここで、

  
    
      
        
          x
          
            1
          
        
        (
        t
        )
      
    
    {\displaystyle x_{1}(t)}
  
 は物体の位置を表す。

  
    
      
        
          x
          
            2
          
        
        (
        t
        )
        :=
        
          
            
              
                x
                
                  1
                
              
              ˙
            
          
        
        (
        t
        )
      
    
    {\displaystyle x_{2}(t):={\dot {x_{1}}}(t)}
  
 は物体の速度を表す。

  
    
      
        
          
            
              
                x
                
                  2
                
              
              ˙
            
          
        
        (
        t
        )
        =
        
          
            
              
                x
                
                  1
                
              
              ¨
            
          
        
        (
        t
        )
      
    
    {\displaystyle {\dot {x_{2}}}(t)={\ddot {x_{1}}}(t)}
  
 は物体の加速度を表す。
出力 
  
    
      
        
          y
        
        (
        t
        )
      
    
    {\displaystyle \mathbf {y} (t)}
  
 は物体の位置である。
可制御性を評価すると、次のようになる。

したがって、
  
    
      
        
          k
          
            1
          
        
      
    
    {\displaystyle k_{1}}
  
 についても 
  
    
      
        m
      
    
    {\displaystyle m}
  
 についてもフルランクである。
可観測性を評価すると、次のようになる。

したがって、フルランクである。以上から、このシステムは制御可能で、かつ観測可能である。

非線形システム
より普遍的な状態空間モデルの形式は次のように表される。

1つ目が状態方程式、2つ目が出力方程式である。
  
    
      
        f
        (
        ⋅
        ,
        ⋅
        ,
        ⋅
        )
      
    
    {\displaystyle f(\cdot ,\cdot ,\cdot )}
  
 が状態と入力の線形な組合せなら、前述のような行列で表現できる。関数の引数である 
  
    
      
        u
        (
        t
        )
      
    
    {\displaystyle u(t)}
  
 は、入力のないシステムでは省略できる。

振り子の例
古典的な非線形システムとして、力を加えない単純な振り子を考える。

ここで、

  
    
      
        θ
        (
        t
        )
      
    
    {\displaystyle \theta (t)}
  
 は（重力の方向から見た）振り子の角度である。

  
    
      
        m
      
    
    {\displaystyle m}
  
 は振り子の質量である（先端にのみ質量があると見なす）。

  
    
      
        g
      
    
    {\displaystyle g}
  
 は重力加速度である。

  
    
      
        k
      
    
    {\displaystyle k}
  
 は支点における摩擦係数である。

  
    
      
        l
      
    
    {\displaystyle l}
  
 は振り子の長さ（回転半径）である（質量 
  
    
      
        m
      
    
    {\displaystyle m}
  
 の重心までの距離）。
すると、状態方程式は次のようになる。

ここで、

  
    
      
        
          x
          
            1
          
        
        (
        t
        )
        :=
        θ
        (
        t
        )
      
    
    {\displaystyle x_{1}(t):=\theta (t)}
  
 は、振り子の角度である。

  
    
      
        
          x
          
            2
          
        
        (
        t
        )
        :=
        
          
            
              
                x
                
                  1
                
              
              ˙
            
          
        
        (
        t
        )
      
    
    {\displaystyle x_{2}(t):={\dot {x_{1}}}(t)}
  
 は、振り子の回転速度である。

  
    
      
        
          
            
              
                x
                
                  2
                
              
              ˙
            
          
        
        =
        
          
            
              
                x
                
                  1
                
              
              ¨
            
          
        
      
    
    {\displaystyle {\dot {x_{2}}}={\ddot {x_{1}}}}
  
 は、振り子の回転加速度である。
状態方程式は、次のようにも書き表せる。

システムの平衡/安定点は 
  
    
      
        
          
            
              x
              ˙
            
          
        
        =
        0
      
    
    {\displaystyle {\dot {x}}=0}
  
 のときであり、従って振り子の平衡点は以下が成り立つ場合である。

ここで n は整数である。

関連項目
制御工学
制御理論
状態観測器
位相空間 (物理学)、 位相空間法

参考文献

Chen, Chi-Tsong 1999. Linear System Theory and Design, 3rd. ed., Oxford University Press (ISBN 0-19-511777-8)
Khalil, Hassan K. Nonlinear Systems, 3rd. ed., Prentice Hall (ISBN 0-13-067389-7)
Nise, Norman S. 2004. Control Systems Engineering, 4th ed., John Wiley & Sons, Inc. (ISBN 0-471-44577-0)
Hinrichsen, Diederich and Pritchard, Anthony J. 2005. Mathematical Systems Theory I, Modelling, State Space Analysis, Stability and Robustness. Springer. (ISBN 978-3-540-44125-0)
Sontag, Eduardo D. 1999. Mathematical Control Theory: Deterministic Finite Dimensional Systems. Second Edition.  Springer.  (ISBN 0-387-984895) (フリーなオンライン版)
Durbin, J. and S. Koopman (2001). Time series analysis by state space methods. Oxford University Press, Oxford. 状態空間の考え方を計量経済学に応用したもの